(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{336:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1-ç®€è¿°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç®€è¿°"}},[t._v("#")]),t._v(" 1. ç®€è¿°")]),t._v(" "),s("p",[t._v("æœ¬ç¯‡æ–‡ç« ä»‹ç»çš„æ˜¯å•æœºå®šæ—¶ä»»åŠ¡çš„å®ç°ï¼Œä¸åŒ…æ‹¬åƒ XXL-JOBã€Power-JOB è¿™æ ·çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ã€‚")]),t._v(" "),s("p",[t._v("å•æœºçš„å®šæ—¶ä»»åŠ¡ç”¨çš„æ¯”è¾ƒå¤šçš„å®ç°æœ‰ JDK æä¾›çš„ "),s("code",[t._v("Timer")]),t._v("ã€"),s("code",[t._v("ScheduledThreadPoolExecutor")]),t._v("ã€Netty å’Œ Dubboçš„ "),s("code",[t._v("HashedWheelTimer")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å®ç°å®šæ—¶ä»»åŠ¡ï¼Œéƒ½è¦ä½¿ç”¨ç‰¹å®šçš„å®¹å™¨ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡éœ€è¦åœ¨æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œï¼Œä½ æ€ä¹ˆçŸ¥é“ä»€ä¹ˆæ—¶å€™æœ‰å“ªäº›ä»»åŠ¡è¦æ‰§è¡Œå‘¢ï¼Ÿæ‰€ä»¥å°±è¦ä½¿ç”¨çº¿ç¨‹ä¸€ç›´è½®è¯¢è¿™ä¸ªå®¹å™¨ã€‚")]),t._v(" "),s("p",[t._v("æ ¹æ®ä¸Šé¢è¯´çš„ï¼Œå®ç°å®šæ—¶ä»»åŠ¡æœ‰ä¸¤ä¸ªå…³é”® ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("å­˜å‚¨ä»»åŠ¡çš„å®¹å™¨")]),t._v(" "),s("li",[t._v("è½®è¯¢å®¹å™¨çš„æ–¹å¼")])]),t._v(" "),s("p",[t._v("æ¥ä¸‹æ¥å°±çœ‹çœ‹"),s("code",[t._v("Timer")]),t._v("ã€"),s("code",[t._v("ScheduledThreadPoolExecutor")]),t._v("ã€ "),s("code",[t._v("HashedWheelTimer")]),t._v(" å®ƒä»¬å¯¹äºå®šæ—¶ä»»åŠ¡çš„å®ç°ã€‚")]),t._v(" "),s("h2",{attrs:{id:"_2-timer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-timer"}},[t._v("#")]),t._v(" 2. Timer")]),t._v(" "),s("p",[t._v("Timer ä½¿ç”¨å †ä½œä¸ºå­˜å‚¨ä»»åŠ¡çš„å®¹å™¨ï¼Œè€Œä¸”æ˜¯"),s("font",{attrs:{color:"blue"}},[s("strong",[t._v("å°æ ¹å †")])]),t._v("ï¼Œ"),s("font",{attrs:{color:"blue"}},[t._v("ä»»åŠ¡æ ¹æ®æ—¶é—´æˆ³çš„å¤§å°åœ¨å †ä¸­æ’åº")]),t._v("ã€‚")],1),t._v(" "),s("p",[t._v("ä½ æƒ³å•Šï¼Œä»»åŠ¡æ˜¯æŒ‡å®šæ—¶é—´æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆæˆ‘å°†ç¦»ç°åœ¨æœ€è¿‘çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´æˆ³æœ€å° çš„ä»»åŠ¡æ”¾åœ¨å°æ ¹å †çš„æœ€ä¸Šé¢ï¼Œçº¿ç¨‹æ¯ä¸€æ¬¡å–ï¼Œéƒ½å¯ä»¥å°†æœ€æ—©éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å–å‡ºæ¥ã€‚çº¿ç¨‹çš„è½®è¯¢æ–¹å¼ä¹Ÿå°±æˆäº†ï¼šå–ä»»åŠ¡ã€æ‰§è¡Œä»»åŠ¡ã€‚å•è°ƒï¼Œæ¯ç‡¥ğŸ˜œ")]),t._v(" "),s("h3",{attrs:{id:"_2-1-timerqueue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-timerqueue"}},[t._v("#")]),t._v(" 2.1 TimerQueue")]),t._v(" "),s("p",[t._v("è¯´åˆ°å †ï¼Œä½ åœ¨ç¬¬ä¸€æ¬¡å­¦ä¹ å †çš„ä½¿ç”¨ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å®ç°çš„å †å‘¢ï¼Ÿæˆ‘çŒœå¤§å¤šæ•°éƒ½æ˜¯ç”¨æ•°ç»„æ¥å®ç°ã€‚Timerä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒTimer ä½¿ç”¨æ•°ç»„æ¥å®ç°å †ï¼Œå¹¶å°†å…¶å°è£…ä¸º "),s("strong",[t._v("TimerQueue")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å…¶å®æˆ‘å®Œå…¨å¯ä»¥å°† TimerQueue çš„å…¨éƒ¨ä»£ç å±•ç¤ºç»™ä½ ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªçŸ­äº†")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TaskQueue")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä½ å¯èƒ½ä¸çŸ¥é“ TimerTaskæ˜¯å•¥ï¼Œä¸é‡è¦ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå­˜æ”¾ä»»åŠ¡çš„æ•°ç»„")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ•°æ®ä¸ªæ•°")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå®¹é‡è¶…äº†å°±æ‰©å®¹ã€‚")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            queue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ·»åŠ ä»»åŠ¡ï¼Œç„¶åæ ¹æ®è¿™ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å°†å…¶å‘ä¸Šè°ƒæ•´")]),t._v("\n        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixUp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–æœ€è¿‘è¦æ‰§è¡Œçš„ä»»åŠ¡")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * åˆ é™¤æœ€è¿‘çš„ä»»åŠ¡\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixUp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" tmp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                j"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n            \n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" tmp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" j"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("heapify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("å®åœ¨æ˜¯ç®€å•åˆ°çˆ†ç‚¸ï¼è¿™ä¸å°±æ˜¯æˆ‘ä»¬å®ç°çš„å †å—ï¼Ÿæ¯«æ— é˜…è¯»éš¾åº¦ã€‚å †æ— éå°±æ˜¯ä¸¤ä¸ªæ“ä½œ ï¼šä¸Šè°ƒã€ä¸‹è°ƒã€‚è¿™é‡Œé¢ fixUpå’Œ fixDown å°±ä»£è¡¨äº†è¿™ä¸¤ä¸ªæ“ä½œã€‚")]),t._v(" "),s("p",[t._v("å…¶å®æˆ‘åˆ å‡äº†éƒ¨åˆ†æ–¹æ³•ï¼Œæˆ‘æ¥å±•ç¤ºå…¶ä¸­ä¸€ä¸ª ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rescheduleMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" newTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fixDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("schedule æ˜¯å®šæ—¶ï¼Œreschedule æ˜¯é‡æ–°å®šæ—¶ï¼Œmin æ˜¯æœ€å°ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ„æ€å°±æ˜¯å°†æœ€è¿‘çš„ä»»åŠ¡é‡æ–°å®šæ—¶ï¼Œç”¨äºä½•å¤„ï¼Ÿä½•æ—¶ä½¿ç”¨å‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("å½“ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œè¿™ä¸ªä»»åŠ¡æ˜¯å®šæ—¶çš„ï¼Œå®ƒä¸€å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œå°±æ˜¯ä¸€å¤©åäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦é‡æ–°è®¡ç®—å®ƒçš„ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œç„¶åå°†å…¶ç§»åˆ°å°æ ¹å †çš„ä¸‹é¢æŸå¤„ã€‚")]),t._v(" "),s("h3",{attrs:{id:"_2-2-timerthread"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-timerthread"}},[t._v("#")]),t._v(" 2.2 TimerThread")]),t._v(" "),s("p",[t._v("æ•´ä¸ªä»£ç ä¹Ÿç‰¹åˆ«ç‰¹åˆ«å°‘ï¼Œåªæœ‰80è¡Œï¼Œä½†æ˜¯æˆ‘åˆä¸å‡†å¤‡ç›´æ¥æ”¾ä»£ç äº†ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªçº¿ç¨‹çš„å·¥ä½œæ–¹å¼ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("ä»å°æ ¹å †å †é¡¶å–å‡ºä»»åŠ¡ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤")]),t._v(" "),s("li",[t._v("è®¡ç®—ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸å½“å‰æ—¶é—´çš„å·®è·ï¼Œè®©æ­¤çº¿ç¨‹ç¡çœ åˆ°ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´")]),t._v(" "),s("li",[t._v("æ‰§è¡Œä»»åŠ¡")]),t._v(" "),s("li",[t._v("é‡æ–°è®¡ç®—è¯¥ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¹¶è°ƒæ•´å°æ ¹å †ã€‚")]),t._v(" "),s("li",[t._v("ç»§ç»­é‡å¤ç¬¬ä¸€æ­¥")])]),t._v(" "),s("p",[t._v("ç”±äºæ˜¯çº¿ç¨‹ï¼Œæ‰€ä»¥è¦å®ç° run() æ–¹æ³•ï¼Œä¸»è¦é€»è¾‘åœ¨ run() æ–¹æ³•ä¸­ ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mainLoop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œç»“æŸæœ‰ä¸¤ç§æƒ…å†µ:")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ­£å¸¸è¿è¡Œç»“æŸ: å°æ ¹å †ä¸­æ— æ•°æ®")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¼‚å¸¸è¿è¡Œç»“æŸ: æœ‰å…¶ä»–çº¿ç¨‹å°†æ­¤ä»»åŠ¡ç»ˆæ­¢ï¼Œæˆ‘ä»¬è¦æ¸…é™¤å°æ ¹å †ä¸­çš„ä»»åŠ¡ã€‚")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                newTasksMayBeScheduled "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œrun() è°ƒç”¨äº† mainLoop() ï¼Œçœ‹åˆ° Loop ä½ å°±åº”è¯¥æƒ³åˆ° "),s("strong",[t._v("å¾ªç¯")]),t._v("ã€"),s("strong",[t._v("è½®è¯¢")]),t._v(" è¿™äº›å…³é”®è¯ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mainLoop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" taskFired"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å°æ ¹å †ä¸­æ— ä»»åŠ¡æ—¶ï¼Œå½“å‰çº¿ç¨‹waité˜»å¡ã€‚")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ­¤çº¿ç¨‹ä»€ä¹ˆæ—¶å€™è¢«å”¤é†’å‘¢ï¼Ÿå» TimerQueue ä¸­å¯»æ‰¾ queue.notifyAllæ²¡æœ‰æ‰¾åˆ°")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›²çŒœå”¤é†’é€»è¾‘åœ¨ Timer ä¸­ã€‚")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newTasksMayBeScheduled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰æ—¶é—´")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" currentTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" executionTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¾—åˆ°æœ€è¿‘è¦æ‰§è¡Œçš„ä»»åŠ¡")]),t._v("\n                    task "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é”ä½è¯¥ä»»åŠ¡")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœä»»åŠ¡å·²ç»å–æ¶ˆï¼Œä¸ç”¨æ‰§è¡Œäº†ï¼Œç›´æ¥åˆ äº†")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CANCELLED")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å½“å‰æ—¶é—´å’Œä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´")]),t._v("\n                        currentTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("currentTimeMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        executionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextExecutionTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼Œé‚£ä¹ˆä»»åŠ¡å°±å¯ä»¥æ‰§è¡Œäº†")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("taskFired "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("executionTime"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v("currentTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çœ‹çœ‹ä»»åŠ¡æ˜¯å‘¨æœŸæ€§ä»»åŠ¡è¿˜æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡å°±æ— éœ€é‡æ–°è®¡ç®—è¯¥ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n                                queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                                task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EXECUTED")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n                                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæ˜¯å‘¨æœŸæ€§ä»»åŠ¡ï¼ŒæŸ¥çœ‹æ˜¯å»¶æ—¶ä»»åŠ¡è¿˜æ˜¯å®šæ—¶ä»»åŠ¡, åŒæ—¶è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´")]),t._v("\n                                queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rescheduleMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                                  task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" currentTime   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period\n                                                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" executionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¤§äºå½“å‰æ—¶é—´ï¼Œæ­¤çº¿ç¨‹ç¡åˆ°ä»»åŠ¡è¯¥æ‰§è¡Œçš„æ—¶å€™ã€‚")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("taskFired"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Task hasn't yet fired; wait")]),t._v("\n                        queue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wait")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("executionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" currentTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œä»»åŠ¡")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("taskFired"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Task fired; run it, holding no locks")]),t._v("\n                    task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",[s("li",[s("p",[t._v("ä¸ºä»€ä¹ˆè¦åŠ é” synchronized(queue) ï¼Ÿ")]),t._v(" "),s("p",[t._v("å› ä¸ºæ­¤çº¿ç¨‹å–ä»»åŠ¡ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å‘ queue ä¸­æ”¾ä»»åŠ¡ï¼Œæ‰€ä»¥è¦å®ç°å¹¶å‘å®‰å…¨ã€‚")]),t._v(" "),s("p",[t._v("åŒæ—¶å¯ä»¥çœ‹åˆ°å®ƒåŠ  synchronized çš„èŒƒå›´ç‰¹åˆ«å°ï¼Œä¸åŒ…æ‹¬ä»»åŠ¡çš„æ‰§è¡Œï¼ŒåªåŒ…æ‹¬ä»»åŠ¡çŠ¶æ€çš„ä¿®æ”¹ã€ä»»åŠ¡æ‰§è¡Œæ—¶é—´çš„ä¿®æ”¹ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å»¶æ—¶ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("p",[t._v("å»¶æ—¶ä»»åŠ¡ç®—ä¸Šäº†ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œå®šæ—¶ä»»åŠ¡ä¸ç®—ã€‚")]),t._v(" "),s("p",[t._v("ä¸¾ä¾‹ï¼šä¸€ä¸ªä»»åŠ¡ 10s æ‰§è¡Œä¸€æ¬¡ï¼Œæ¯æ¬¡æ‰§è¡Œ 5s")]),t._v(" "),s("p",[t._v("å¦‚æœè¯¥ä»»åŠ¡ä¸ºå®šæ—¶ä»»åŠ¡ ï¼šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸º 10ã€20ã€30ã€40...")]),t._v(" "),s("p",[t._v("å¦‚æœè¯¥ä»»åŠ¡æ˜¯å»¶æ—¶ä»»åŠ¡ ï¼šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸º 10ã€25ã€40ã€55")])])]),t._v(" "),s("p",[t._v("TimerThread æ˜¯å¦‚ä½•åŒºåˆ†å®šæ—¶ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡çš„å‘¢ï¼Ÿæ¥çœ‹ä¸¤ä¸ªæ–¹æ³• ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å»¶æ—¶ä»»åŠ¡")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" firstTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sched")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" firstTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å®šæ—¶ä»»åŠ¡")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleAtFixedRate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimerTask")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" firstTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sched")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" firstTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è°ƒç”¨ super(...) æ—¶ "),s("strong",[t._v("period")]),t._v(" çš„æ­£è´Ÿï¼Œç°åœ¨å†å›å»çœ‹ TimerThread é‡æ–°è®¡ç®—ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é‚£ä¸€æ®µå§ ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// currentTime : å½“å‰æ—¶é—´ï¼Œæ¢è¨€ä¹‹ï¼Œä»»åŠ¡æ‰§è¡Œçš„ç»“æŸæ—¶é—´")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executionTime : ä»»åŠ¡å¼€å§‹æ‰§è¡Œçš„æ—¶é—´")]),t._v("\n\tqueue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rescheduleMin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    \ttask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" \n        currentTime   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n        executionTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("period\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-3-æ€»ç»“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-æ€»ç»“"}},[t._v("#")]),t._v(" 2.3 æ€»ç»“")]),t._v(" "),s("p",[t._v("æ²¡äº†ï¼ŒTimerå°±æ˜¯å¦‚æ­¤ç®€å•ã€‚ä½¿ç”¨å°æ ¹å †å­˜æ”¾å®šæ—¶ä»»åŠ¡ï¼Œä½¿ç”¨çº¿ç¨‹æ‰«æå°æ ¹å †çš„å †é¡¶ã€‚")]),t._v(" "),s("h2",{attrs:{id:"_3-scheduledthreadpoolexecutor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-scheduledthreadpoolexecutor"}},[t._v("#")]),t._v(" 3. ScheduledThreadPoolExecutor")]),t._v(" "),s("p",[t._v("ScheduledThreadPoolExecutor ä¹Ÿä½¿ç”¨å †ä½œä¸ºå­˜å‚¨ä»»åŠ¡çš„å®¹å™¨ï¼Œå”¯ä¸€ä¸ Timer ä¸åŒçš„æ˜¯ï¼Œæ‰«æå®¹å™¨çš„çº¿ç¨‹å˜å¤šäº†ã€‚")]),t._v(" "),s("h2",{attrs:{id:"_4-hashedwheeltimer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-hashedwheeltimer"}},[t._v("#")]),t._v(" 4. HashedWheelTimer")]),t._v(" "),s("p",[t._v("Netty å’Œ Dubbo ä»¥åŠå¾ˆå¤šæ¡†æ¶éƒ½æœ‰å®ƒçš„å¯¹åº”å®ç°ï¼Œæ ¸å¿ƒæ€æƒ³éƒ½ä¸€æ ·ã€‚å®ƒä»¬éƒ½å°†ä»»åŠ¡æ”¾åœ¨æ•°ç»„ä¸­ï¼Œä½¿ç”¨çº¿ç¨‹æ‰«ææ•°ç»„ã€‚")]),t._v(" "),s("p",[t._v("ï¼ˆåªæ Netty å’Œ Dubbo æ˜¯å› ä¸ºæˆ‘åªçœ‹è¿‡å®ƒä¿©çš„æºç ï¼Œå…¶å® Kafka çš„æ—¶é—´è½®æ›´åŠï¼Œå¯ä»¥ä½œä¸ºä½ çš„æ‰©å±•å­¦ä¹ å†…å®¹ï¼‰")]),t._v(" "),s("p",[t._v("ä¸å †ä¸åŒçš„æ˜¯ï¼Œæ­¤æ•°ç»„æ¨¡æ‹Ÿçš„æ˜¯ä¸€ä¸ªè½®å­ï¼Œå®ƒçš„æ¯ä¸€ä¸ªåˆ»åº¦ä»£è¡¨ç€ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ¯”å¦‚å¤§å°ä¸º 60 çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥ä»£è¡¨1sï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å°±å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªé’Ÿè¡¨ï¼Œçº¿ç¨‹æ¨¡æ‹Ÿç§’é’ˆï¼Œåœ¨å¾ªç¯éå†çš„æ—¶å€™åªéœ€è¦æ¯ 1s æ‰§è¡Œé‚£ä¸ªæ—¶é—´æ®µçš„æ‰€æœ‰ä»»åŠ¡ï¼Œå°±å¯ä»¥å®ç°â€œå®šæ—¶åŠŸèƒ½â€ã€‚")]),t._v(" "),s("p",[t._v("é—®ä¸€ä¸ªé—®é¢˜ï¼Œå“ªä¸ªçº¿ç¨‹å°†ä»»åŠ¡æ”¾åœ¨æ—¶é—´è½®ä¸­ï¼Ÿä»»åŠ¡çº¿ç¨‹ä¼šå–æ—¶é—´è½®ä¸­çš„ä»»åŠ¡å»æ‰§è¡Œï¼Œmain çº¿ç¨‹å¦‚æœå¯ä»¥ç›´æ¥æ¥è§¦åˆ°æ—¶é—´è½®çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¿è¯æ—¶é—´è½®çš„å¹¶å‘å®‰å…¨äº†ã€‚ä½†æ˜¯æˆ‘ä¸æƒ³è®©å¹¶å‘é—®é¢˜å‘ç”Ÿåœ¨æ—¶é—´è½®ä¸Šï¼Œå¦‚ä½•å®ç°ï¼Ÿ")]),t._v(" "),s("ol",[s("li",[t._v("main çº¿ç¨‹å°†ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªæ™®é€šçš„æ•°ç»„ä¸­")]),t._v(" "),s("li",[t._v("ä»»åŠ¡çº¿ç¨‹å°†ä»»åŠ¡ä»æ™®é€šçš„æ•°ç»„ä¸­å–å‡ºï¼Œè®¡ç®—ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œç„¶åå°†å…¶æ”¾åˆ°å¯¹åº”çš„åˆ»åº¦ä¸Šã€‚")])]),t._v(" "),s("p",[t._v("ä¸è®© main çº¿ç¨‹æ¥è§¦åˆ°æ—¶é—´è½®æ•°ç»„ï¼Œå°±å¯ä»¥å°†å¹¶å‘é—®é¢˜æ§åˆ¶åœ¨æ™®é€šæ•°ç»„ä¸­ï¼Œæ—¶é—´è½®åªè´Ÿè´£å°†ä»»åŠ¡æŒ‰ç…§æ—¶é—´ç»´åº¦å­˜å‚¨å³å¯ã€‚ä¸ºä»€ä¹ˆè¦å°†å¹¶å‘é—®é¢˜æ§åˆ¶åœ¨æ™®é€šæ•°ç»„è€Œä¸æ˜¯æ—¶é—´è½®æ•°ç»„ï¼Ÿå› ä¸ºæ”¾åœ¨æ™®é€šæ•°ç»„æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¾/å–ï¼›è€Œæ”¾åœ¨æ—¶é—´è½®æ•°ç»„ä¸­ï¼Œæˆ‘ä»¬å–åè¿˜è¦åˆ¤æ–­ä¸‹æ¬¡æ—¶é—´å†æ”¾è¿›å»ï¼Œæ¶‰åŠåˆ°å¾ˆå¤šçŠ¶æ€çš„ä¿®æ”¹ï¼Œäºæ˜¯å¹¶å‘æƒ…å†µå°±æ›´å¤šã€‚")]),t._v(" "),s("p",[t._v("è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ ï¼šå¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ç¦»ç°åœ¨å¤ªè¿œäº†ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ˜å¤©æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª 24 * 60 * 60 ä¸ªå…ƒç´ çš„æ•°ç»„å—ï¼Ÿè‚¯å®šä¸èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœˆæ•°æ¥ä»£è¡¨ä»»åŠ¡è·ç¦»ç°åœ¨çš„æ—¶é—´ï¼Œæ˜å¤©æ‰§è¡Œçš„ä»»åŠ¡å¯ä»¥æ”¾åœ¨ç¬¬1ä¸ªåˆ»åº¦ä¸Šï¼Œè¯¥ä»»åŠ¡çš„åœˆæ•°ä¸º 24 * 60ï¼Œæ¯ä¸€æ¬¡å¾ªç¯åˆ°å®ƒéƒ½å°†è¿™ä¸ªåœˆæ•°å‡1ï¼Œå½“åœˆæ•°ä¸º 0 æ—¶å³å¯æ‰§è¡Œã€‚")]),t._v(" "),s("p",[t._v("é—®é¢˜æ€»ç»“å®Œäº†ï¼Œæ¥çœ‹ä¸€ä¸‹ HashedWheelTimer çš„å·¥ä½œæµç¨‹ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("main çº¿ç¨‹è´Ÿè´£å°†ä»»åŠ¡æ”¾åˆ°æ™®é€šæ•°ç»„ä¸­")]),t._v(" "),s("li",[t._v("ä»»åŠ¡çº¿ç¨‹æ¯æ¬¡å¾ªç¯éƒ½ä»æ™®é€šæ•°ç»„ä¸­å–ä»»åŠ¡ï¼Œå°†å…¶æ”¾åˆ°å¯¹åº”çš„åˆ»åº¦ä¸­ï¼Œç„¶åæ‰§è¡Œæ­¤æ—¶æŒ‡å‘çš„åˆ»åº¦ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚")])])])}),[],!1,null,null,null);s.default=e.exports}}]);